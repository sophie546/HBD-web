<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday Adventure! üéÅ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Dancing+Script:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Add this new CSS for the play again screen */
        .play-again-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            z-index: 9999;
            display: none;
            opacity: 0;
            transition: opacity 1s ease;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
        }

        .play-again-screen.show {
            display: flex;
            opacity: 1;
        }

        .play-again-content {
            max-width: 600px;
            width: 90%;
            animation: playAgainIn 1s ease-out forwards;
        }

        @keyframes playAgainIn {
            0% {
                transform: translateY(50px) scale(0.8);
                opacity: 0;
            }
            100% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .play-again-title {
            font-size: 3.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, #ff1493, #ff69b4, #ffc3e0, #ff69b4, #ff1493);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: prizeShine 3s ease-in-out infinite;
            margin-bottom: 20px;
            font-family: 'Dancing Script', cursive;
            line-height: 1.2;
        }

        .play-again-subtitle {
            font-size: 1.5rem;
            color: #ffc3e0;
            margin-bottom: 40px;
            font-weight: 300;
        }

        .play-again-stats {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin: 30px 0;
            border: 2px solid rgba(255, 105, 180, 0.3);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1.1rem;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #ffc3e0;
        }

        .stat-value {
            color: #ff69b4;
            font-weight: 600;
        }

        .play-again-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .play-again-btn {
            padding: 18px 40px;
            font-size: 1.2rem;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 200px;
            justify-content: center;
        }

        .play-again-btn-primary {
            background: linear-gradient(135deg, #ff1493, #ff69b4);
            color: white;
            box-shadow: 0 10px 30px rgba(255, 20, 147, 0.4);
        }

        .play-again-btn-primary:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 40px rgba(255, 20, 147, 0.6);
        }

        .play-again-btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid rgba(255, 105, 180, 0.5);
            backdrop-filter: blur(10px);
        }

        .play-again-btn-secondary:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 105, 180, 0.8);
        }

        .celebration-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        /* Add fade-out animation for existing elements */
        .fade-out {
            opacity: 0 !important;
            transform: scale(0.95) !important;
            filter: blur(10px) !important;
            pointer-events: none;
            transition: all 1s ease !important;
        }

        /* Rest of your existing CSS remains the same */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ffc3e0 0%, #ffe0f0 50%, #fff0f7 100%);
            overflow: hidden;
            height: 100vh;
            position: relative;
            transition: all 1s ease;
        }

        body.video-mode {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
        }

        /* Floating decorations */
        .decoration {
            position: absolute;
            font-size: 2.5rem;
            opacity: 0.25;
            animation: float 8s ease-in-out infinite;
            pointer-events: none;
            filter: drop-shadow(0 4px 8px rgba(255, 105, 180, 0.2));
            color: #ff1493;
            transition: opacity 1s ease;
        }

        body.video-mode .decoration {
            opacity: 0.1;
        }

        .decoration i {
            font-size: inherit;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-30px) rotate(10deg); }
        }

        /* Instructions Panel */
        .instructions-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px; /* Reduced padding */
            border-radius: 20px;
            box-shadow: 
                0 12px 30px rgba(255, 105, 180, 0.3),
                inset 0 -2px 10px rgba(255, 192, 203, 0.2);
            border: 3px solid #ff69b4;
            z-index: 500;
            max-width: 280px; /* Reduced width */
            backdrop-filter: blur(10px);
            transition: all 1s ease;
        }

        body.video-mode .instructions-panel {
            opacity: 0.3;
            transform: scale(0.9);
        }

        .instructions-header {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #ff1493;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 1rem; /* Smaller font */
        }

        .instructions-header i {
            font-size: 1.2rem;
        }

        .instructions-content {
            color: #c71585;
            font-size: 0.85rem; /* Smaller font */
            line-height: 1.4;
        }

        .instructions-step {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 8px;
            padding: 6px;
            border-radius: 8px;
            background: rgba(255, 192, 203, 0.1);
        }

        .step-number {
            width: 22px;
            height: 22px;
            background: linear-gradient(135deg, #ff1493, #ff69b4);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.75rem;
            flex-shrink: 0;
            margin-top: 1px;
        }

        .step-text {
            flex: 1;
            font-size: 0.8rem;
        }

        .current-step {
            background: rgba(255, 105, 180, 0.15);
            border: 2px solid #ff69b4;
        }

        /* Success State */
        .success-goal {
            color: #ff1493;
            font-weight: 700;
            font-size: 0.9rem;
            background: rgba(255, 20, 147, 0.1);
            padding: 8px;
            border-radius: 10px;
            text-align: center;
            margin-top: 5px;
        }

        .success-goal i {
            color: #ff1493;
            margin-right: 5px;
        }

        /* Game container */
        .game-container {
            position: relative;
            width: 100%;
            height: 100vh;
            perspective: 1200px;
            overflow: hidden;
            transition: all 1s ease;
        }

        body.video-mode .game-container {
            filter: blur(5px) brightness(0.5);
            transform: scale(0.95);
        }

        /* Map/Scene */
        .scene {
            position: absolute;
            width: 1200px;
            height: 800px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotateX(45deg) rotateZ(0deg);
            transform-style: preserve-3d;
            transition: transform 0.3s ease;
        }

        .ground {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ffb3d9 0%, #ffd9ec 50%, #ffe6f2 100%);
            border-radius: 50px;
            box-shadow: 
                0 20px 60px rgba(255, 105, 180, 0.3),
                inset 0 -10px 30px rgba(255, 255, 255, 0.5);
            border: 10px solid #ff69b4;
            position: relative;
            overflow: hidden;
            transition: all 1s ease;
        }

        .ground::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.3) 0%, transparent 30%),
                radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.2) 0%, transparent 25%);
            pointer-events: none;
        }

        /* Decorative elements on ground */
        .ground-deco {
            position: absolute;
            font-size: 3rem;
            opacity: 0.15;
            pointer-events: none;
            color: #ff69b4;
            transition: opacity 1s ease;
        }

        body.video-mode .ground-deco {
            opacity: 0.05;
        }

        .ground-deco i {
            font-size: inherit;
        }

        /* Path decoration */
        .path {
            position: absolute;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 25px;
            box-shadow: 
                inset 0 4px 15px rgba(255, 192, 203, 0.3),
                0 2px 10px rgba(255, 255, 255, 0.5);
            border: 3px solid rgba(255, 255, 255, 0.8);
        }

        .path-1 {
            width: 130px;
            height: 280px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .path-2 {
            width: 450px;
            height: 130px;
            top: 25%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .path-3 {
            width: 450px;
            height: 130px;
            bottom: 10%;
            left: 50%;
            transform: translate(-50%, 0);
        }

        /* Modern Teddy Bear Character */
        .teddy {
            position: absolute;
            width: 90px;
            height: 90px;
            transition: transform 0.1s linear;
            z-index: 100;
            filter: drop-shadow(0 15px 25px rgba(0, 0, 0, 0.25));
            will-change: transform;
            transform: translateZ(0);
        }

        .teddy-inner {
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, #d4a373, #c4915e);
            border-radius: 50%;
            position: relative;
            animation: teddyBreathe 3s ease-in-out infinite;
            border: 4px solid #fff;
            box-shadow: 
                inset 0 -8px 15px rgba(0, 0, 0, 0.15),
                inset 0 8px 15px rgba(255, 255, 255, 0.3);
        }

        @keyframes teddyBreathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .teddy-face {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            color: #8B4513;
        }

        .teddy-ears {
            position: absolute;
            width: 35px;
            height: 35px;
            background: linear-gradient(145deg, #c4915e, #b4815e);
            border-radius: 50%;
            border: 3px solid #fff;
            box-shadow: inset 0 -4px 8px rgba(0, 0, 0, 0.2);
        }

        .teddy-ears.left {
            top: -8px;
            left: 5px;
        }

        .teddy-ears.right {
            top: -8px;
            right: 5px;
        }

        /* Modern Gift Boxes with Numbering */
        .gift-box {
            position: absolute;
            width: 110px;
            height: 110px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            filter: drop-shadow(0 20px 30px rgba(255, 105, 180, 0.4));
        }

        .gift-box-inner {
            width: 100%;
            height: 100%;
            position: relative;
            animation: giftFloat 3s ease-in-out infinite;
        }

        @keyframes giftFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(5deg); }
        }

        .gift-base {
            width: 85%;
            height: 85%;
            background: linear-gradient(145deg, #ff1493, #ff69b4);
            border-radius: 18px;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 
                inset 0 -8px 15px rgba(0, 0, 0, 0.2),
                inset 0 8px 15px rgba(255, 255, 255, 0.3),
                0 10px 25px rgba(255, 20, 147, 0.3);
            border: 4px solid #fff;
        }

        .gift-lid {
            width: 95%;
            height: 30%;
            background: linear-gradient(145deg, #ff69b4, #ff1493);
            border-radius: 15px 15px 8px 8px;
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 
                inset 0 -4px 10px rgba(0, 0, 0, 0.2),
                inset 0 4px 10px rgba(255, 255, 255, 0.4),
                0 5px 15px rgba(255, 20, 147, 0.3);
            border: 3px solid #fff;
        }

        .gift-ribbon {
            position: absolute;
            width: 15px;
            height: 100%;
            background: linear-gradient(90deg, #ffd700, #ffed4e);
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .gift-bow {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2.5rem;
            filter: drop-shadow(0 4px 8px rgba(255, 215, 0, 0.5));
            color: #ff69b4;
        }

        /* Gift Number Indicator */
        .gift-number {
            position: absolute;
            top: -35px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #ff1493, #ff69b4);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            border: 3px solid white;
            box-shadow: 0 5px 15px rgba(255, 20, 147, 0.4);
            z-index: 10;
        }

        .gift-box:hover .gift-box-inner {
            transform: translateY(-10px) scale(1.1) rotate(10deg) !important;
        }

        .gift-box.locked {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(0.5) drop-shadow(0 20px 30px rgba(255, 105, 180, 0.2));
        }

        .gift-box.locked:hover .gift-box-inner {
            transform: none !important;
            animation: giftShake 0.5s ease-in-out infinite;
        }

        @keyframes giftShake {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-5px) rotate(-2deg); }
            75% { transform: translateY(-5px) rotate(2deg); }
        }

        .gift-box.opened {
            opacity: 0.4;
            pointer-events: none;
        }

        .gift-box.opened .gift-box-inner {
            animation: none;
        }

        /* Video Modal Styling */
        .video-modal {
            z-index: 2000;
        }

        .video-modal .modal-content {
            max-width: 800px;
            background: rgba(0, 0, 0, 0.9);
            border: none;
            padding: 0;
            overflow: hidden;
            animation: videoModalIn 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes videoModalIn {
            0% { transform: translate(-50%, -50%) scale(0.5) rotate(-10deg); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }
        }

        .video-container {
            width: 100%;
            position: relative;
            background: #000;
            contain: content;
        }

        .video-player {
            width: 100%;
            height: 450px;
            outline: none;
            border: none;
            object-fit: contain;
            background: #000;
            transform: translateZ(0);
            backface-visibility: hidden;
            will-change: transform;
        }

        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            text-align: center;
            padding: 20px;
            transition: opacity 0.3s ease;
            z-index: 2;
            transform: translateZ(0);
        }

        .video-overlay.hidden {
            opacity: 0;
            pointer-events: none;
            visibility: hidden;
            display: none !important;
        }

        .video-title {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #ff69b4;
            font-family: 'Dancing Script', cursive;
            text-shadow: 0 0 20px rgba(255, 105, 180, 0.5);
        }

        .video-subtitle {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: #ffc3e0;
        }

        .play-video-btn {
            padding: 18px 45px;
            font-size: 1.3rem;
            background: linear-gradient(135deg, #ff1493, #ff69b4);
            border: none;
            border-radius: 30px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 30px rgba(255, 20, 147, 0.4);
        }

        .play-video-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 40px rgba(255, 20, 147, 0.6);
        }

        .video-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 3;
            transform: translateZ(0);
        }

        .video-container:hover .video-controls {
            opacity: 1;
        }

        .video-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .video-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .video-progress {
            flex-grow: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            margin: 0 20px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
        }

        .video-progress-filled {
            position: absolute;
            height: 100%;
            background: linear-gradient(to right, #ff69b4, #ff1493);
            width: 0%;
            transition: width 0.2s linear;
            transform: translateZ(0);
        }

        .video-time {
            color: white;
            font-size: 0.9rem;
            min-width: 100px;
            text-align: center;
        }

        /* Modal for messages */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(15px);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: linear-gradient(145deg, #fff 0%, #ffe6f2 100%);
            padding: 35px;
            border-radius: 35px;
            max-width: 500px;
            width: 90%;
            box-shadow: 
                0 40px 80px rgba(255, 20, 147, 0.3),
                inset 0 -2px 10px rgba(255, 105, 180, 0.1);
            border: 6px solid #ff69b4;
            animation: modalSlideIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes modalSlideIn {
            to { transform: translate(-50%, -50%) scale(1); }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-icon {
            font-size: 3.5rem;
            margin-bottom: 10px;
            animation: iconPop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            color: #ff1493;
        }

        @keyframes iconPop {
            0% { transform: scale(0) rotate(-180deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .modal-header h2 {
            color: #ff1493;
            font-size: 1.8rem;
            margin-bottom: 8px;
            font-weight: 700;
            text-shadow: 2px 2px 8px rgba(255, 105, 180, 0.2);
            font-family: 'Dancing Script', cursive;
        }

        .modal-header p {
            color: #ff69b4;
            font-size: 1rem;
            font-weight: 500;
        }

        .modal-body {
            background: white;
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: 
                inset 0 2px 15px rgba(255, 105, 180, 0.08),
                0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .message-input {
            width: 100%;
            min-height: 140px;
            padding: 15px;
            border: 3px solid #ff69b4;
            border-radius: 18px;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            background: linear-gradient(145deg, #fff, #fff0f7);
            transition: all 0.3s ease;
        }

        .message-input:focus {
            outline: none;
            border-color: #ff1493;
            box-shadow: 0 0 0 4px rgba(255, 20, 147, 0.1);
        }

        .message-display {
            font-size: 1.1rem;
            line-height: 1.7;
            color: #c71585;
            text-align: center;
            font-weight: 500;
        }

        .sticker-display {
            text-align: center;
            font-size: 8rem;
            animation: stickerPop 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            margin: 15px 0;
            color: #8B4513;
        }

        .fa-dog {
            font-size: 8rem !important;
            animation: stickerPop 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes stickerPop {
            0% { transform: scale(0) rotate(-180deg); }
            60% { transform: scale(1.15) rotate(10deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .modal-footer {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
            font-family: 'Poppins', sans-serif;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn span {
            position: relative;
            z-index: 1;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff1493, #ff69b4);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 25px rgba(255, 20, 147, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #ffc3e0, #ffb3d9);
            color: #c71585;
        }

        .btn-secondary:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 25px rgba(255, 105, 180, 0.4);
        }

        /* Locked Gift Warning Modal */
        .locked-modal .modal-content {
            max-width: 400px;
            text-align: center;
        }

        .locked-icon {
            font-size: 4rem;
            color: #ff69b4;
            margin-bottom: 20px;
            animation: lockShake 0.8s ease-in-out;
        }

        @keyframes lockShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .locked-message {
            color: #c71585;
            font-size: 1.2rem;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .next-gift-hint {
            color: #ff1493;
            font-size: 0.9rem; /* Smaller font */
            background: rgba(255, 192, 203, 0.2);
            padding: 10px;
            border-radius: 8px;
            margin-top: 15px;
        }

        /* Modern Keyboard Controls Display */
        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 12px 20px; /* Smaller padding */
            border-radius: 20px;
            box-shadow: 
                0 12px 30px rgba(255, 105, 180, 0.3),
                inset 0 -2px 10px rgba(255, 192, 203, 0.2);
            border: 3px solid #ff69b4;
            z-index: 500;
            backdrop-filter: blur(10px);
            transition: all 1s ease;
        }

        body.video-mode .controls {
            opacity: 0.3;
            transform: translateX(-50%) scale(0.9);
        }

        .controls-header {
            text-align: center;
            color: #ff1493;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.9rem; /* Smaller font */
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .keyboard-display {
            display: grid;
            grid-template-columns: repeat(3, 45px); /* Smaller keys */
            gap: 6px;
            justify-content: center;
        }

        .key {
            width: 45px;
            height: 45px;
            background: linear-gradient(145deg, #ffffff, #ffe6f2);
            border: 2px solid #ff69b4;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem; /* Smaller font */
            font-weight: 700;
            color: #ff1493;
            box-shadow: 
                0 4px 10px rgba(255, 105, 180, 0.2),
                inset 0 -2px 5px rgba(255, 105, 180, 0.1);
            transition: all 0.1s ease;
            position: relative;
            cursor: pointer;
            user-select: none;
            touch-action: manipulation;
        }

        .key::after {
            content: attr(data-key);
            position: absolute;
            bottom: 3px;
            right: 5px;
            font-size: 0.5rem; /* Smaller font */
            opacity: 0.6;
            font-weight: 600;
        }

        .key:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 6px 15px rgba(255, 105, 180, 0.3),
                inset 0 -2px 5px rgba(255, 105, 180, 0.15);
        }

        .key.active {
            transform: translateY(2px);
            box-shadow: 
                0 1px 5px rgba(255, 105, 180, 0.3),
                inset 0 2px 8px rgba(255, 105, 180, 0.2);
            background: linear-gradient(145deg, #ffc3e0, #ffb3d9);
        }

        .key:nth-child(1) {
            grid-column: 2;
            grid-row: 1;
        }

        .key:nth-child(2) {
            grid-column: 1;
            grid-row: 2;
        }

        .key:nth-child(3) {
            grid-column: 2;
            grid-row: 2;
        }

        .key:nth-child(4) {
            grid-column: 3;
            grid-row: 2;
        }

        /* Progress indicator */
        .progress {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 12px 20px; /* Smaller padding */
            border-radius: 20px;
            box-shadow: 
                0 12px 30px rgba(255, 105, 180, 0.3),
                inset 0 -2px 10px rgba(255, 192, 203, 0.2);
            border: 3px solid #ff69b4;
            z-index: 500;
            text-align: center;
            backdrop-filter: blur(10px);
            transition: all 1s ease;
        }

        body.video-mode .progress {
            opacity: 0.3;
            transform: scale(0.9);
        }

        .progress h3 {
            color: #ff1493;
            margin-bottom: 8px;
            font-size: 1rem; /* Smaller font */
            font-weight: 700;
            font-family: 'Dancing Script', cursive;
        }

        .progress-boxes {
            display: flex;
            gap: 10px; /* Smaller gap */
            justify-content: center;
        }

        .progress-box {
            width: 40px; /* Smaller boxes */
            height: 40px;
            background: linear-gradient(145deg, #fff, #ffe6f2);
            border: 3px solid #ffb3d9;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem; /* Smaller icon */
            opacity: 0.3;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 4px 12px rgba(255, 105, 180, 0.15);
            color: #ff1493;
        }

        .progress-box.opened {
            opacity: 1;
            border-color: #ff1493;
            background: linear-gradient(145deg, #ffc3e0, #ffb3d9);
            animation: progressPop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 6px 20px rgba(255, 20, 147, 0.3);
        }

        @keyframes progressPop {
            0% { transform: scale(0.5) rotate(-90deg); }
            60% { transform: scale(1.2) rotate(10deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        /* Final prize */
        .prize-modal .modal-content {
            max-width: 550px;
            text-align: center;
        }

        .prize-text {
            font-size: 2.8rem;
            font-weight: 900;
            background: linear-gradient(135deg, #ff1493, #ff69b4, #ffc3e0, #ff69b4, #ff1493);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: prizeShine 3s ease-in-out infinite;
            margin: 25px 0;
            filter: drop-shadow(0 4px 12px rgba(255, 20, 147, 0.3));
            font-family: 'Dancing Script', cursive;
            line-height: 1.2;
        }

        @keyframes prizeShine {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .hearts-container {
            font-size: 2.8rem;
            animation: heartsFloat 3s ease-in-out infinite;
            color: #ff1493;
            margin: 10px 0;
        }

        @keyframes heartsFloat {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.1); }
        }

        .prize-message {
            color: #c71585;
            font-size: 1.1rem; /* Slightly smaller */
            margin-top: 20px;
            font-weight: 500;
            font-family: 'Dancing Script', cursive;
        }

        /* Dance Party Styles - BIGGER CAT GIF! */
        .dance-modal .modal-content {
            max-width: 750px; /* Wider modal */
            background: linear-gradient(145deg, #fff 0%, #ffe6f2 100%);
        }

        .cat-dance-container {
            width: 100%;
            height: 300px; /* Bigger height */
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            border-radius: 20px;
            overflow: hidden;
            background: linear-gradient(145deg, #ffc3e0, #ffb3d9);
            position: relative;
        }

        .cat-gif {
            max-width: 90%; /* Bigger GIF */
            max-height: 90%;
            object-fit: contain;
            border-radius: 15px;
            box-shadow: 0 15px 40px rgba(255, 20, 147, 0.4); /* Bigger shadow */
        }

        .dance-text {
            text-align: center;
            font-size: 3rem; /* Bigger text */
            font-weight: 900;
            background: linear-gradient(135deg, #ff1493, #ff69b4, #ffc3e0, #ff69b4, #ff1493);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: prizeShine 2s ease-in-out infinite;
            margin: 25px 0;
            font-family: 'Dancing Script', cursive;
        }

        /* Smaller notes in dance modal */
        .dance-modal .modal-header h2 {
            font-size: 2.2rem; /* Slightly smaller */
        }

        .dance-modal .modal-header p {
            font-size: 0.9rem; /* Smaller notes */
            color: #ff69b4;
            margin-top: 5px;
        }

        .audio-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 80%;
        }

        .volume-slider {
            width: 100%;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, #ff69b4, #ff1493);
            border-radius: 4px;
            outline: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ff1493;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 0 10px rgba(255, 20, 147, 0.5);
        }

        .audio-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
            background: linear-gradient(135deg, #ff1493, #ff69b4);
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .audio-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 25px rgba(255, 20, 147, 0.4);
        }

        .party-effects {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1500;
            overflow: hidden;
        }

        .party-effect {
            position: absolute;
            font-size: 2rem;
            animation: partyFloat 4s linear forwards;
            opacity: 0;
            pointer-events: none;
        }

        @keyframes partyFloat {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .scene {
                width: 90vw;
                height: 70vh;
            }

            .teddy {
                width: 70px;
                height: 70px;
            }

            .gift-box {
                width: 85px;
                height: 85px;
            }

            .gift-number {
                width: 35px;
                height: 35px;
                top: -30px;
                font-size: 1rem;
            }

            .instructions-panel {
                top: 10px;
                left: 10px;
                right: 10px;
                max-width: none;
                padding: 12px;
            }

            .progress {
                top: auto;
                bottom: 100px;
                right: 10px;
                padding: 10px 15px;
            }

            .controls {
                bottom: 15px;
                padding: 10px 15px;
            }

            .keyboard-display {
                grid-template-columns: repeat(3, 40px);
                gap: 5px;
            }

            .key {
                width: 40px;
                height: 40px;
                font-size: 0.8rem;
            }

            .prize-text {
                font-size: 2.2rem;
            }

            .sticker-display {
                font-size: 6rem;
            }

            .fa-dog {
                font-size: 6rem !important;
            }

            .modal-content {
                padding: 25px;
            }

            .modal-header h2 {
                font-size: 1.6rem;
            }

            .prize-message {
                font-size: 1rem;
            }

            /* Dance modal adjustments for mobile */
            .cat-dance-container {
                height: 300px; /* Still bigger on mobile */
            }
            
            .dance-text {
                font-size: 2.2rem; /* Slightly smaller on mobile */
            }
            
            .dance-modal .modal-content {
                padding: 20px;
                max-width: 90%;
            }

            .video-modal .modal-content {
                max-width: 95%;
            }

            .video-player {
                height: 300px;
            }

            .video-title {
                font-size: 2rem;
            }

            .video-subtitle {
                font-size: 1rem;
            }

            /* Play again screen responsive */
            .play-again-title {
                font-size: 2.5rem;
            }

            .play-again-subtitle {
                font-size: 1.2rem;
            }

            .play-again-buttons {
                flex-direction: column;
                align-items: center;
            }

            .play-again-btn {
                min-width: 250px;
                padding: 15px 30px;
            }
        }
    </style>
</head>
<body>
    <!-- Floating decorations with Font Awesome icons -->
    <div class="decoration" style="top: 8%; left: 5%; animation-delay: 0s;">
        <i class="fas fa-spa"></i>
    </div>
    <div class="decoration" style="top: 15%; right: 8%; animation-delay: 1.5s;">
        <i class="fas fa-sparkles"></i>
    </div>
    <div class="decoration" style="bottom: 12%; left: 10%; animation-delay: 3s;">
        <i class="fas fa-birthday-cake"></i>
    </div>
    <div class="decoration" style="bottom: 20%; right: 15%; animation-delay: 2s;">
        <i class="fas fa-heart"></i>
    </div>

    <!-- Instructions Panel -->
    <div class="instructions-panel" id="instructionsPanel">
        <div class="instructions-header">
            <i class="fas fa-map-signs"></i>
            <h3>How to Play</h3>
        </div>
        <div class="instructions-content">
            <div class="instructions-step" id="step1">
                <div class="step-number">1</div>
                <div class="step-text">Move the teddy bear using W-A-S-D keys or arrow keys</div>
            </div>
            <div class="instructions-step" id="step2">
                <div class="step-number">2</div>
                <div class="step-text">Open gifts in order: <strong>Gift 1 ‚Üí Gift 2 ‚Üí Gift 3</strong></div>
            </div>
            <div class="instructions-step" id="step3">
                <div class="step-number">3</div>
                <div class="step-text">Each gift contains a special surprise for you!</div>
            </div>
            <div id="currentGoalContainer">
                <div class="success-goal" id="successGoal" style="display: none;">
                    <i class="fas fa-trophy"></i> Current Goal: Success!
                </div>
                <div class="instructions-step" id="step4">
                    <div class="step-number">üéÅ</div>
                    <div class="step-text"><strong>Current Goal:</strong> Open <span id="currentGoal">Gift 1</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Progress Indicator -->
    <div class="progress">
        <h3>Gifts Discovered</h3>
        <div class="progress-boxes">
            <div class="progress-box" id="progress1"><i class="fas fa-gift"></i></div>
            <div class="progress-box" id="progress2"><i class="fas fa-gift"></i></div>
            <div class="progress-box" id="progress3"><i class="fas fa-gift"></i></div>
        </div>
    </div>

    <!-- Game Container -->
    <div class="game-container">
        <div class="scene" id="scene">
            <div class="ground">
                <!-- Ground decorations with Font Awesome -->
                <div class="ground-deco" style="top: 10%; left: 15%;">
                    <i class="fas fa-seedling"></i>
                </div>
                <div class="ground-deco" style="top: 70%; right: 20%;">
                    <i class="fas fa-flower"></i>
                </div>
                <div class="ground-deco" style="bottom: 15%; left: 25%;">
                    <i class="fas fa-sun"></i>
                </div>
                <div class="ground-deco" style="top: 20%; right: 30%;">
                    <i class="fas fa-heartbeat"></i>
                </div>

                <!-- Paths -->
                <div class="path path-1"></div>
                <div class="path path-2"></div>
                <div class="path path-3"></div>

                <!-- Modern Teddy Bear -->
                <div class="teddy" id="teddy" style="left: 50%; top: 50%; transform: translate(-50%, -50%);">
                    <div class="teddy-inner">
                        <div class="teddy-ears left"></div>
                        <div class="teddy-ears right"></div>
                        <div class="teddy-face">
                            <i class="fas fa-paw"></i>
                        </div>
                    </div>
                </div>

                <!-- Modern Gift Boxes with Numbers -->
                <!-- Gift 1: Message (Original position) -->
                <div class="gift-box" id="gift1" style="left: 50%; top: 15%; transform: translate(-50%, -50%);" data-gift="1">
                    <div class="gift-number">1</div>
                    <div class="gift-box-inner">
                        <div class="gift-base">
                            <div class="gift-ribbon"></div>
                        </div>
                        <div class="gift-lid"></div>
                        <div class="gift-bow">
                            <i class="fas fa-ribbon"></i>
                        </div>
                    </div>
                </div>
                
                <!-- Gift 2: VIDEO GIFT (previously Gift 3) -->
                <div class="gift-box locked" id="gift2" style="left: 80%; top: 75%; transform: translate(-50%, -50%);" data-gift="2">
                    <div class="gift-number">2</div>
                    <div class="gift-box-inner">
                        <div class="gift-base">
                            <div class="gift-ribbon"></div>
                        </div>
                        <div class="gift-lid"></div>
                        <div class="gift-bow">
                            <i class="fas fa-ribbon"></i>
                        </div>
                    </div>
                </div>
                
                <!-- Gift 3: Snoopy Sticker (previously Gift 2) -->
                <div class="gift-box locked" id="gift3" style="left: 20%; top: 40%; transform: translate(-50%, -50%);" data-gift="3">
                    <div class="gift-number">3</div>
                    <div class="gift-box-inner">
                        <div class="gift-base">
                            <div class="gift-ribbon"></div>
                        </div>
                        <div class="gift-lid"></div>
                        <div class="gift-bow">
                            <i class="fas fa-ribbon"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Keyboard Controls Display -->
    <div class="controls">
        <div class="controls-header">
            <i class="fas fa-gamepad"></i> Move Teddy Bear
        </div>
        <div class="keyboard-display">
            <div class="key" id="keyW" data-key="W">W</div>
            <div class="key" id="keyA" data-key="A">A</div>
            <div class="key" id="keyS" data-key="S">S</div>
            <div class="key" id="keyD" data-key="D">D</div>
        </div>
    </div>

    <!-- Modal for Gift 1 (Editable Message) -->
    <div class="modal" id="modal1">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon"><i class="fas fa-envelope"></i></div>
                <h2>Your Heartfelt Message</h2>
                <p>Write something special for the birthday star!</p>
            </div>
            <div class="modal-body">
                <textarea class="message-input" id="messageInput" placeholder="Type your heartfelt message here...">Happy Birthday! You bring so much joy to everyone around you. May this year be filled with love, laughter, and endless happiness! üíï</textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveAndContinue()"><span><i class="fas fa-gift"></i> Continue to Gift 2</span></button>
            </div>
        </div>
    </div>

    <!-- Modal for Gift 3 (Snoopy Sticker) -->
    <div class="modal" id="modal3">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon"><i class="fas fa-sparkles"></i></div>
                <h2>Cute Surprise!</h2>
            </div>
            <div class="modal-body">
                <div class="sticker-display">
                    <i class="fas fa-dog"></i>
                </div>
                <p style="text-align: center; color: #ff69b4; font-size: 1.2rem; margin-top: 20px; font-weight: 600;">
                    A loyal friend just for you! üêæ
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeModal(3)"><span><i class="fas fa-gift"></i> Continue to Final Prize</span></button>
            </div>
        </div>
    </div>

    <!-- Video Modal for Gift 2 -->
    <div class="modal video-modal" id="modal2" style="display: none;">
        <div class="modal-content">
            <div class="video-container">
                <video class="video-player" id="birthdayVideo" preload="none">
                    <source src="assets/videos/hopelessly-devoted.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <div class="video-overlay" id="videoOverlay">
                    <div class="video-title">Hopelessly Devoted to You</div>
                    <div class="video-subtitle">A video that represents us! üíï</div>
                    <button class="play-video-btn" onclick="playVideo()">
                        <i class="fas fa-play"></i> Play Video
                    </button>
                </div>
                <div class="video-controls">
                    <div class="video-progress" onclick="seekVideo(event)">
                        <div class="video-progress-filled" id="videoProgress"></div>
                    </div>
                    <div class="video-time">
                        <span id="currentTime">0:00</span> / <span id="duration">0:00</span>
                    </div>
                    <button class="video-btn" onclick="toggleMute()" id="muteBtn">
                        <i class="fas fa-volume-up"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Locked Gift Warning Modal -->
    <div class="modal locked-modal" id="lockedModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <div class="locked-icon"><i class="fas fa-lock"></i></div>
                <h2>Gift is Locked!</h2>
            </div>
            <div class="modal-body">
                <div class="locked-message">
                    You need to open Gift <span id="requiredGift">1</span> first!
                </div>
                <p style="text-align: center; color: #c71585; margin-bottom: 15px;">
                    Open gifts in the correct order:
                </p>
                <div class="progress-boxes" style="justify-content: center; margin: 15px 0;">
                    <div class="progress-box" id="lockedProgress1"><i class="fas fa-gift"></i></div>
                    <i class="fas fa-arrow-right" style="color: #ff69b4; align-self: center;"></i>
                    <div class="progress-box" id="lockedProgress2"><i class="fas fa-gift"></i></div>
                    <i class="fas fa-arrow-right" style="color: #ff69b4; align-self: center;"></i>
                    <div class="progress-box" id="lockedProgress3"><i class="fas fa-gift"></i></div>
                </div>
                <div class="next-gift-hint">
                    <i class="fas fa-lightbulb"></i> 
                    Hint: Look for Gift <span id="hintGift">1</span> with the number on top!
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeLockedModal()"><span><i class="fas fa-check"></i> OK, I'll Follow the Order!</span></button>
            </div>
        </div>
    </div>

    <!-- Final Prize Modal -->
    <div class="modal prize-modal" id="prizeModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon"><i class="fas fa-party-horn"></i></div>
                <h2>Congratulations!</h2>
                <p style="font-size: 0.9rem;">You've discovered all the gifts!</p>
            </div>
            <div class="modal-body">
                <div class="hearts-container">
                    üíï üíñ üíó üíï üíñ
                </div>
                <div class="prize-text">
                    You are my everything <br>:"(( Please be mine forever
                </div>
                <div class="hearts-container">
                    üíó üíñ üíï üíó üíñ
                </div>
                <p class="prize-message">
                    Wishing you the most magical birthday ever! üéÇ
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="startDanceParty()"><span><i class="fas fa-glass-cheers"></i> Celebrate!</span></button>
            </div>
        </div>
    </div>

    <!-- Dance Party Modal -->
    <div class="modal dance-modal" id="danceModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Dance Party!</h2>
              <p style="font-size: 0.75rem; line-height: 1.2; opacity: 0.8;">
                    Dance Party! Let's celebrate with dancing cats! Dance Time! Play Party Music
                </p>
            </div>
            <div class="modal-body">
                <div class="cat-dance-container" id="catDanceContainer">
                    <!-- ADD YOUR DANCING CAT GIF URL HERE -->
                    <img src="assets/images/dancing-cat.gif" alt="Dancing Cat" class="cat-gif" id="catGif">
                </div>
                <div class="dance-text">
                    Dance Time!
                </div>
                <div class="audio-controls">
                    <div class="volume-control">
                        <i class="fas fa-volume-down"></i>
                        <input type="range" min="0" max="1" step="0.1" value="0.5" class="volume-slider" id="volumeSlider">
                        <i class="fas fa-volume-up"></i>
                    </div>
                    <button class="audio-btn" id="musicToggleBtn" onclick="togglePartyMusic()">
                        <i class="fas fa-play"></i> Play Party Music
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="stopDanceParty()"><span><i class="fas fa-stop"></i> Stop Party</span></button>
                <button class="btn btn-primary" onclick="moreConfetti()"><span><i class="fas fa-sparkles"></i> More Confetti!</span></button>
            </div>
        </div>
    </div>

    <!-- Play Again Screen -->
    <div class="play-again-screen" id="playAgainScreen">
        <div class="play-again-content">
            <div class="play-again-title">Adventure Complete!</div>
            <div class="play-again-subtitle">You've discovered all the birthday surprises!</div>
            
            <div class="play-again-stats">
                <div class="stat-item">
                    <span class="stat-label"><i class="fas fa-gift"></i> Gifts Opened:</span>
                    <span class="stat-value" id="statGifts">3/3</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label"><i class="fas fa-heart"></i> Special Message:</span>
                    <span class="stat-value" id="statMessage">Saved</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label"><i class="fas fa-video"></i> Video Watched:</span>
                    <span class="stat-value" id="statVideo">‚úì</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label"><i class="fas fa-dog"></i> Snoopy Friend:</span>
                    <span class="stat-value" id="statSnoopy">Adopted</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label"><i class="fas fa-trophy"></i> Final Prize:</span>
                    <span class="stat-value" id="statPrize">Claimed</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Party Effects Container -->
    <div class="party-effects" id="partyEffects"></div>

    <script>
        // Game variables
        let teddyPosition = { x: 50, y: 50 };
        let openedGifts = new Set();
        let savedMessage = "Happy Birthday JD! You bring so much joy to everyone around you and to your wife as well. May this year be filled with love, laughter, and endless happiness for you my cutie! üíï, I am always thankful to have you as my partner, thank you so much for bringing light, comfort and peace to my life. I am so proud of you always my jadey lablab kita so much!!";
        let keyStates = {};
        let moveAnimationFrame = null;
        let isMoving = false;
        let currentDirection = null;
        
        // Sequential gift system
        let currentGiftToOpen = 1;
        const totalGifts = 3;

        // Video variables
        let video = null;
        let isVideoPlaying = false;
        let videoUpdateLoop = null;

        // Dance party variables
        let partyMusic = null;
        let isPartyMusicPlaying = false;
        let partyInterval = null;

        // Cache DOM elements
        const teddy = document.getElementById('teddy');
        let giftCache = null;

        // ========== INITIAL SETUP ==========
        function initializeGame() {
            updateInstructions();
            updateLockedGifts();
        }

        // ========== SEQUENTIAL GIFT SYSTEM ==========
        function updateInstructions() {
            const currentGoal = document.getElementById('currentGoal');
            const step4 = document.getElementById('step4');
            const successGoal = document.getElementById('successGoal');
            
            if (openedGifts.size === 3) {
                // All gifts opened - show success
                if (step4) step4.style.display = 'none';
                if (successGoal) successGoal.style.display = 'block';
            } else if (currentGiftToOpen <= totalGifts) {
                // Still have gifts to open
                if (currentGoal) {
                    currentGoal.textContent = `Gift ${currentGiftToOpen}`;
                }
                if (step4) step4.style.display = 'flex';
                if (successGoal) successGoal.style.display = 'none';
            }
            
            // Highlight current step
            document.querySelectorAll('.instructions-step').forEach(step => {
                step.classList.remove('current-step');
            });
            
            if (currentGiftToOpen <= 3) {
                const stepElement = document.getElementById(`step${currentGiftToOpen}`);
                if (stepElement) {
                    stepElement.classList.add('current-step');
                }
            }
        }

        function updateLockedGifts() {
            for (let i = 1; i <= totalGifts; i++) {
                const gift = document.getElementById(`gift${i}`);
                if (i > currentGiftToOpen) {
                    gift.classList.add('locked');
                } else {
                    gift.classList.remove('locked');
                }
            }
        }

        function showLockedWarning(giftNum) {
            document.getElementById('requiredGift').textContent = currentGiftToOpen;
            document.getElementById('hintGift').textContent = currentGiftToOpen;
            
            // Update progress indicators in locked modal
            for (let i = 1; i <= totalGifts; i++) {
                const progressBox = document.getElementById(`lockedProgress${i}`);
                if (progressBox) {
                    if (openedGifts.has(i)) {
                        progressBox.classList.add('opened');
                    } else {
                        progressBox.classList.remove('opened');
                    }
                }
            }
            
            document.getElementById('lockedModal').style.display = 'block';
        }

        function closeLockedModal() {
            document.getElementById('lockedModal').style.display = 'none';
        }

        // ========== MOVEMENT FUNCTIONS ==========
        function startMoving(direction) {
            if (isMoving && currentDirection === direction) return;
            
            if (moveAnimationFrame) {
                cancelAnimationFrame(moveAnimationFrame);
                moveAnimationFrame = null;
            }
            
            currentDirection = direction;
            isMoving = true;
            
            function moveStep() {
                if (!isMoving) return;
                
                const step = 2;
                
                switch(direction) {
                    case 'up':
                        teddyPosition.y = Math.max(10, teddyPosition.y - step);
                        break;
                    case 'down':
                        teddyPosition.y = Math.min(90, teddyPosition.y + step);
                        break;
                    case 'left':
                        teddyPosition.x = Math.max(10, teddyPosition.x - step);
                        break;
                    case 'right':
                        teddyPosition.x = Math.min(90, teddyPosition.x + step);
                        break;
                }
                
                teddy.style.left = teddyPosition.x + '%';
                teddy.style.top = teddyPosition.y + '%';
                
                checkCollisions();
                
                moveAnimationFrame = requestAnimationFrame(moveStep);
            }
            
            moveAnimationFrame = requestAnimationFrame(moveStep);
        }

        function stopMoving() {
            isMoving = false;
            currentDirection = null;
            
            if (moveAnimationFrame) {
                cancelAnimationFrame(moveAnimationFrame);
                moveAnimationFrame = null;
            }
        }

        // ========== KEYBOARD CONTROLS ==========
        function activateKey(key) {
            const keyElement = document.getElementById('key' + key.toUpperCase());
            if (keyElement) keyElement.classList.add('active');
        }

        function deactivateKey(key) {
            const keyElement = document.getElementById('key' + key.toUpperCase());
            if (keyElement) keyElement.classList.remove('active');
        }

        document.addEventListener('keydown', (e) => {
            const key = e.key.toLowerCase();
            
            if (keyStates[key]) return;
            keyStates[key] = true;
            
            switch(key) {
                case 'arrowup':
                case 'w':
                    e.preventDefault();
                    startMoving('up');
                    activateKey('w');
                    break;
                case 'arrowdown':
                case 's':
                    e.preventDefault();
                    startMoving('down');
                    activateKey('s');
                    break;
                case 'arrowleft':
                case 'a':
                    e.preventDefault();
                    startMoving('left');
                    activateKey('a');
                    break;
                case 'arrowright':
                case 'd':
                    e.preventDefault();
                    startMoving('right');
                    activateKey('d');
                    break;
            }
        });

        document.addEventListener('keyup', (e) => {
            const key = e.key.toLowerCase();
            keyStates[key] = false;
            
            switch(key) {
                case 'arrowup':
                case 'w':
                    stopMoving();
                    deactivateKey('w');
                    break;
                case 'arrowdown':
                case 's':
                    stopMoving();
                    deactivateKey('s');
                    break;
                case 'arrowleft':
                case 'a':
                    stopMoving();
                    deactivateKey('a');
                    break;
                case 'arrowright':
                case 'd':
                    stopMoving();
                    deactivateKey('d');
                    break;
            }
        });

        // ========== COLLISION DETECTION ==========
        function getGiftCache() {
            if (!giftCache) {
                giftCache = [
                    document.getElementById('gift1'),
                    document.getElementById('gift2'),
                    document.getElementById('gift3')
                ];
            }
            return giftCache;
        }

        function checkCollisions() {
            const teddyRect = teddy.getBoundingClientRect();
            const gifts = getGiftCache();
            
            for (let i = 0; i < gifts.length; i++) {
                const gift = gifts[i];
                if (!gift.classList.contains('opened')) {
                    const giftRect = gift.getBoundingClientRect();
                    
                    if (teddyRect.left < giftRect.right - 20 &&
                        teddyRect.right > giftRect.left + 20 &&
                        teddyRect.top < giftRect.bottom - 20 &&
                        teddyRect.bottom > giftRect.top + 20) {
                        
                        const giftNum = i + 1;
                        if (giftNum === currentGiftToOpen) {
                            openGift(giftNum);
                        } else if (giftNum > currentGiftToOpen) {
                            showLockedWarning(giftNum);
                        }
                        break;
                    }
                }
            }
        }

        // ========== GIFT FUNCTIONS ==========
        function openGift(giftNum) {
            if (openedGifts.has(giftNum) || giftNum !== currentGiftToOpen) return;
            
            openedGifts.add(giftNum);
            document.getElementById('gift' + giftNum).classList.add('opened');
            document.getElementById('progress' + giftNum).classList.add('opened');
            
            // Update current gift to open
            if (giftNum < totalGifts) {
                currentGiftToOpen = giftNum + 1;
            } else {
                currentGiftToOpen = 4; // All gifts opened
            }
            
            updateInstructions();
            updateLockedGifts();
            
            stopMoving();
            
            setTimeout(() => {
                if (giftNum === 1) showModal1();
                else if (giftNum === 2) showVideoModal(); // Gift 2 is now video
                else if (giftNum === 3) showModal3(); // Gift 3 is now Snoopy sticker
            }, 300);
        }

        function showModal1() {
            const modal = document.getElementById('modal1');
            const messageInput = document.getElementById('messageInput');
            messageInput.value = savedMessage;
            modal.style.display = 'block';
        }

        function showModal3() {
            document.getElementById('modal3').style.display = 'block';
        }

        function showVideoModal() {
            document.body.classList.add('video-mode');
            document.getElementById('modal2').style.display = 'block'; // Using modal2 for video
            
            // Initialize video
            initVideo();
        }

        function closeModal(num) {
            document.getElementById('modal' + num).style.display = 'none';
            checkAllGiftsOpened();
        }

        function saveAndContinue() {
            savedMessage = document.getElementById('messageInput').value;
            closeModal(1);
        }

        function checkAllGiftsOpened() {
            if (openedGifts.size === 3) {
                setTimeout(() => {
                    showPrizeModal();
                }, 500);
            }
        }

        function showPrizeModal() {
            document.getElementById('prizeModal').style.display = 'block';
            createConfetti();
        }

        // ========== PLAY AGAIN SYSTEM ==========
        function showPlayAgainScreen() {
            // Fade out all existing elements
            const elementsToFade = [
                '.instructions-panel',
                '.progress',
                '.controls',
                '.decoration',
                '.game-container',
                '.modal'
            ];
            
            elementsToFade.forEach(selector => {
                document.querySelectorAll(selector).forEach(el => {
                    el.classList.add('fade-out');
                });
            });
            
            // Update stats
            document.getElementById('statGifts').textContent = '3/3';
            document.getElementById('statMessage').textContent = savedMessage.length > 50 ? 'Saved' : 'Not Saved';
            document.getElementById('statVideo').textContent = '‚úì';
            document.getElementById('statSnoopy').textContent = 'Adopted';
            document.getElementById('statPrize').textContent = 'Claimed';
            
            // Show play again screen after delay
            setTimeout(() => {
                document.getElementById('playAgainScreen').classList.add('show');
                createFinalCelebration();
            }, 1000);
        }

        function restartGame() {
            // Reset game state
            openedGifts.clear();
            currentGiftToOpen = 1;
            teddyPosition = { x: 50, y: 50 };
            teddy.style.left = '50%';
            teddy.style.top = '50%';
            
            // Reset all gifts
            for (let i = 1; i <= totalGifts; i++) {
                const gift = document.getElementById(`gift${i}`);
                gift.classList.remove('opened');
                gift.classList.remove('locked');
                if (i > 1) gift.classList.add('locked');
                
                const progress = document.getElementById(`progress${i}`);
                progress.classList.remove('opened');
            }
            
            // Hide play again screen
            document.getElementById('playAgainScreen').classList.remove('show');
            
            // Remove fade-out from all elements
            const elementsToReset = [
                '.instructions-panel',
                '.progress',
                '.controls',
                '.decoration',
                '.game-container'
            ];
            
            elementsToReset.forEach(selector => {
                document.querySelectorAll(selector).forEach(el => {
                    el.classList.remove('fade-out');
                });
            });
            
            // Re-initialize game
            updateInstructions();
            updateLockedGifts();
            
            // Stop any party music
            if (partyMusic && isPartyMusicPlaying) {
                partyMusic.pause();
                isPartyMusicPlaying = false;
            }
            
            // Clear party effects
            document.getElementById('partyEffects').innerHTML = '';
            
            // Show success message
            setTimeout(() => {
                alert('Game reset! Start your adventure again! üéÅ');
            }, 300);
        }

        function shareAdventure() {
            const shareText = `I just completed a Birthday Adventure! üéâ Discovered 3 amazing gifts with heartfelt messages, videos, and surprises! Try it yourself! üéÅ #BirthdayAdventure #HappyBirthday`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Birthday Adventure Completed!',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                // Fallback: Copy to clipboard
                navigator.clipboard.writeText(shareText + '\n\n' + window.location.href)
                    .then(() => {
                        alert('Adventure link copied to clipboard! Share it with friends! üìã');
                    })
                    .catch(() => {
                        prompt('Copy this link to share:', window.location.href);
                    });
            }
        }

        function createFinalCelebration() {
            // Create a massive confetti celebration
            const colors = ['#ff1493', '#ff69b4', '#ffc3e0', '#ffb3d9', '#ffe0f0', '#ffffff'];
            
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.position = 'fixed';
                    confetti.style.width = Math.random() * 20 + 10 + 'px';
                    confetti.style.height = Math.random() * 20 + 10 + 'px';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.top = '-50px';
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    confetti.style.zIndex = '9999';
                    confetti.style.pointerEvents = 'none';
                    confetti.style.opacity = '0.9';
                    
                    document.getElementById('playAgainScreen').appendChild(confetti);
                    
                    const animation = confetti.animate([
                        { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                        { transform: `translateY(100vh) rotate(${Math.random() * 720}deg)`, opacity: 0 }
                    ], {
                        duration: Math.random() * 3000 + 2000,
                        easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                    });
                    
                    animation.onfinish = () => confetti.remove();
                }, i * 50);
            }
            
            // Play celebration sound if available
            try {
                const celebrationSound = new Audio();
                celebrationSound.src = 'assets/music/celebration.mp3';
                celebrationSound.volume = 0.3;
                celebrationSound.play();
            } catch (e) {
                console.log('No celebration sound available');
            }
        }

        // ========== VIDEO FUNCTIONS ==========
        function initVideo() {
            video = document.getElementById('birthdayVideo');
            
            if (!video) return;
            
            // Reset video state
            video.currentTime = 0;
            isVideoPlaying = false;
            
            // Reset UI
            document.getElementById('videoOverlay').classList.remove('hidden');
            document.getElementById('videoProgress').style.width = '0%';
            document.getElementById('currentTime').textContent = '0:00';
            document.getElementById('duration').textContent = '0:00';
            
            // Set volume
            video.volume = 0.7;
            video.muted = false;
            
            // Clear previous event listeners
            video.onloadedmetadata = null;
            video.onended = null;
            
            // Set up event listeners
            video.onloadedmetadata = function() {
                document.getElementById('duration').textContent = formatTime(video.duration);
            };
            
            video.onended = function() {
                console.log("Video ended");
                isVideoPlaying = false;
                
                // Stop update loop
                if (videoUpdateLoop) {
                    cancelAnimationFrame(videoUpdateLoop);
                    videoUpdateLoop = null;
                }
                
                // Close video modal after delay
                setTimeout(() => {
                    closeVideoModal();
                }, 500);
            };
            
            // Load video
            video.load();
        }

        function playVideo() {
            if (!video) return;
            
            console.log("Playing video...");
            
            // Hide overlay
            document.getElementById('videoOverlay').classList.add('hidden');
            
            // Play video
            video.play().then(() => {
                console.log("Video started playing");
                isVideoPlaying = true;
                startVideoUpdateLoop();
            }).catch(error => {
                console.error("Video play error:", error);
                document.getElementById('videoOverlay').classList.remove('hidden');
                
                // Try muted playback
                video.muted = true;
                video.play().then(() => {
                    isVideoPlaying = true;
                    startVideoUpdateLoop();
                    setTimeout(() => { video.muted = false; }, 1000);
                }).catch(e => {
                    console.error("Muted play failed:", e);
                    alert("Click the play button to start the video.");
                });
            });
        }

        function startVideoUpdateLoop() {
            if (videoUpdateLoop) {
                cancelAnimationFrame(videoUpdateLoop);
            }
            
            function updateLoop() {
                if (video && !video.paused && !video.ended) {
                    updateProgress();
                    document.getElementById('currentTime').textContent = formatTime(video.currentTime);
                    videoUpdateLoop = requestAnimationFrame(updateLoop);
                }
            }
            
            videoUpdateLoop = requestAnimationFrame(updateLoop);
        }

        function updateProgress() {
            if (!video || !video.duration || video.duration === 0) return;
            
            const progress = (video.currentTime / video.duration) * 100;
            document.getElementById('videoProgress').style.width = progress + '%';
        }

        function toggleMute() {
            if (!video) return;
            
            video.muted = !video.muted;
            document.getElementById('muteBtn').innerHTML = video.muted ? 
                '<i class="fas fa-volume-mute"></i>' : 
                '<i class="fas fa-volume-up"></i>';
        }

        function seekVideo(event) {
            if (!video || !video.duration) return;
            
            const progressBar = event.currentTarget;
            const rect = progressBar.getBoundingClientRect();
            const clickPosition = event.clientX - rect.left;
            const totalWidth = rect.width;
            const percentage = Math.max(0, Math.min(1, clickPosition / totalWidth));
            
            video.currentTime = percentage * video.duration;
            updateProgress();
        }

        function formatTime(seconds) {
            if (!seconds || isNaN(seconds)) return "0:00";
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        function closeVideoModal() {
            console.log("Closing video modal");
            
            if (video) {
                video.pause();
                video.currentTime = 0;
                isVideoPlaying = false;
                
                if (videoUpdateLoop) {
                    cancelAnimationFrame(videoUpdateLoop);
                    videoUpdateLoop = null;
                }
            }
            
            // Reset overlay
            document.getElementById('videoOverlay').classList.remove('hidden');
            
            // Remove video mode
            document.body.classList.remove('video-mode');
            
            // Hide modal
            document.getElementById('modal2').style.display = 'none';
            
            // Mark gift 2 as opened (video gift is now gift 2)
            closeModal(2);
        }

        // ========== DANCE PARTY FUNCTIONS ==========
        function startDanceParty() {
            document.getElementById('prizeModal').style.display = 'none';
            
            setTimeout(() => {
                document.getElementById('danceModal').style.display = 'block';
                startPartyEffects();
            }, 300);
        }

        function playPartyMusic() {
            if (!partyMusic) {
                partyMusic = new Audio();
                partyMusic.src = 'assets/music/dancing-cat.mp3';
                partyMusic.loop = true;
                partyMusic.volume = 0.5;
            }
            
            partyMusic.play()
                .then(() => {
                    isPartyMusicPlaying = true;
                    updateMusicButton();
                })
                .catch(error => {
                    console.log("Music auto-play prevented");
                });
        }

        function togglePartyMusic() {
            if (!partyMusic) {
                playPartyMusic();
                return;
            }
            
            if (isPartyMusicPlaying) {
                partyMusic.pause();
                isPartyMusicPlaying = false;
            } else {
                partyMusic.play()
                    .then(() => {
                        isPartyMusicPlaying = true;
                    })
                    .catch(error => {
                        console.log("Could not play audio:", error);
                    });
            }
            updateMusicButton();
        }

        function updateMusicButton() {
            const btn = document.getElementById('musicToggleBtn');
            if (isPartyMusicPlaying) {
                btn.innerHTML = '<i class="fas fa-pause"></i> Pause Music';
                btn.style.background = 'linear-gradient(135deg, #ff1493, #ff69b4)';
            } else {
                btn.innerHTML = '<i class="fas fa-play"></i> Play Party Music';
                btn.style.background = 'linear-gradient(135deg, #4CAF50, #45a049)';
            }
        }

        function startPartyEffects() {
            if (partyInterval) clearInterval(partyInterval);
            
            partyInterval = setInterval(() => {
                createPartyEffect();
            }, 500);
            
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    createPartyEffect();
                }, i * 200);
            }
        }

        function createPartyEffect() {
            const effects = ['üéâ', 'üéä', '‚ú®', 'üíñ', 'üíï'];
            const effect = document.createElement('div');
            effect.className = 'party-effect';
            effect.textContent = effects[Math.floor(Math.random() * effects.length)];
            effect.style.left = Math.random() * 100 + 'vw';
            effect.style.fontSize = (Math.random() * 1.5 + 1) + 'rem';
            effect.style.color = getRandomColor();
            
            document.getElementById('partyEffects').appendChild(effect);
            
            setTimeout(() => {
                if (effect.parentNode) {
                    effect.parentNode.removeChild(effect);
                }
            }, 4000);
        }

        function getRandomColor() {
            const colors = ['#ff1493', '#ff69b4', '#ffc3e0', '#ffb3d9', '#ffe0f0'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        function stopDanceParty() {
            if (partyMusic && isPartyMusicPlaying) {
                partyMusic.pause();
                isPartyMusicPlaying = false;
                updateMusicButton();
            }
            
            if (partyInterval) {
                clearInterval(partyInterval);
                partyInterval = null;
            }
            
            document.getElementById('partyEffects').innerHTML = '';
            document.getElementById('danceModal').style.display = 'none';
            createConfetti();
            
            // After dance party ends, show play again screen
            setTimeout(() => {
                showPlayAgainScreen();
            }, 1000);
        }

        function moreConfetti() {
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    createPartyEffect();
                }, i * 100);
            }
        }

        // Confetti effect
        function createConfetti() {
            const colors = ['#ff1493', '#ff69b4', '#ffc3e0', '#ffb3d9', '#ffe0f0'];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.position = 'fixed';
                    confetti.style.width = '10px';
                    confetti.style.height = '10px';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.top = '-20px';
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    confetti.style.zIndex = '9999';
                    confetti.style.pointerEvents = 'none';
                    
                    document.body.appendChild(confetti);
                    
                    const animation = confetti.animate([
                        { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                        { transform: `translateY(100vh) rotate(${Math.random() * 720}deg)`, opacity: 0 }
                    ], {
                        duration: Math.random() * 2000 + 3000,
                        easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                    });
                    
                    animation.onfinish = () => confetti.remove();
                }, i * 50);
            }
        }

        // ========== EVENT LISTENERS ==========
        document.getElementById('volumeSlider')?.addEventListener('input', function(e) {
            if (partyMusic) {
                partyMusic.volume = e.target.value;
            }
        });

        // Click on gift boxes
        document.querySelectorAll('.gift-box').forEach(gift => {
            gift.addEventListener('click', function() {
                if (this.classList.contains('locked')) {
                    const giftNum = parseInt(this.dataset.gift);
                    showLockedWarning(giftNum);
                    return;
                }
                
                if (!this.classList.contains('opened')) {
                    const giftNum = parseInt(this.dataset.gift);
                    if (giftNum === currentGiftToOpen) {
                        openGift(giftNum);
                    }
                }
            });
        });

        // Mobile key controls
        const keys = {
            'keyW': 'up',
            'keyA': 'left',
            'keyS': 'down',
            'keyD': 'right'
        };

        Object.entries(keys).forEach(([keyId, direction]) => {
            const keyElement = document.getElementById(keyId);
            if (!keyElement) return;
            
            keyElement.addEventListener('mousedown', () => {
                startMoving(direction);
                keyElement.classList.add('active');
            });
            
            keyElement.addEventListener('mouseup', () => {
                stopMoving();
                keyElement.classList.remove('active');
            });
            
            keyElement.addEventListener('mouseleave', () => {
                if (keyElement.classList.contains('active')) {
                    stopMoving();
                    keyElement.classList.remove('active');
                }
            });
        });

        // Initialize the game
        window.addEventListener('load', () => {
            initializeGame();
            checkCollisions();
        });
    </script>
</body>
</html>